{"version":3,"sources":["../src/OauthGithub.js"],"names":[],"mappings":"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","file":"OauthGithub.js","sourcesContent":["'use strict';\n\nimport assert from 'assert';\nimport * as electron from 'electron';\nimport {BrowserWindow,app} from 'electron';\nimport request from 'superagent';\n\n//const isDev = require('electron-is-dev')\n\n\nexport default class AuthWindow {\n  constructor({ id, secret, remote = false,scopes = [], waitForApp = false }) {\n    assert(id, 'Client ID is needed!');\n    assert(secret, 'Client Secret is needed!');\n    this.scopeQuery = scopes.length > 0 ? '&scope=' + scopes.join('%2C') : '';\n    this.clientId = id;\n    this.clientSecret = secret;\n    this.waitForApp = waitForApp;\n    this.remote = remote === true;\n    this.window = null;\n    this.electron = (this.remote) ? electron.remote : electron;\n    this.app = this.electron.app;\n    this.BrowserWindow = this.electron.BrowserWindow;\n\n  }\n\n\n\n  startRequest(callback) {\n\n    const doAuth = () => {\n      this.window = new this.BrowserWindow({\n        width: 800,\n        height: 600,\n        webPreferences: {\n          nodeIntegration: true, webSecurity: false\n        }\n      });\n\n\n      var authURL = 'https://github.com/login/oauth/authorize?client_id=' + this.clientId + this.scopeQuery;\n\n      this.window.webContents.on('did-finish-load', () => {\n        this.window.show();\n        this.window.focus();\n      });\n\n      this.window.webContents.on('did-fail-load',(event,errorCode,errorDescription,validatedURL,isMainFrame) => {\n        console.error('LOAD FAILED',event,errorCode,errorDescription,validatedURL,isMainFrame);\n        callback({errorCode,errorDescription,validatedURL,isMainFrame})\n      });\n\n      this.window.webContents.on('will-navigate', (event, url) => {\n        this.handleCallback(url, callback);\n      });\n      this.window.webContents.on('did-get-redirect-request', (event, oldUrl, newUrl) => {\n        this.handleCallback(newUrl, callback);\n      });\n      this.window.on('close', () => {\n        this.window = null;\n      }, false);\n\n      this.window.loadURL(authURL);\n    };\n\n    (this.waitForApp) ? this.app.on('ready', doAuth) : doAuth()\n  }\n\n  handleCallback(url, callback) {\n    let raw_code = /code=([^&]*)/.exec(url) || null;\n    let code = (raw_code && raw_code.length > 1) ? raw_code[1] : null;\n    let error = /\\?error=(.+)$/.exec(url);\n\n    if (code) {\n      this.requestGithubToken(this.clientId, this.clientSecret, this.scopeQuery, code, callback);\n    } else if (error) {\n      console.log(error);\n    }\n  }\n\n  requestGithubToken(id, secret, scopes, code, callback) {\n    request.post('https://github.com/login/oauth/access_token', {\n      client_id: id,\n      client_secret: secret,\n      code: code,\n    }).end((err, response) => {\n      try {\n        if (err) {\n          callback(err);\n        } else {\n          callback(null, response.body.access_token, this);\n        }\n      } finally {\n        this.window.close()\n      }\n    });\n  }\n\n}\n"]}